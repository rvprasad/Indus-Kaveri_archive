<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE project PUBLIC "-//ANT//DTD project//EN" "/usr/share/emacs/site-lisp/dtds/ant/project.dtd"
[<!ENTITY include SYSTEM "message.xml">]>
<!-- $Revision$ -->

<project name="indus" default="dist" basedir=".">
    <tstamp/>

    <property name="drishti.jar" value="/usr/local/javaclasses/doxygen.jar"/>
    <property name="dist.dir" value="dist"/>
    <property name="dist.ug.dir" value="${dist.dir}/ug"/>
    <property name="docs.zip.filename" value="${dist.dir}/docs-${DSTAMP}.zip"/>
    <property name="examples.src.zip.filename" value="${dist.dir}/examples-${DSTAMP}.zip"/>

    <path id="subprojects.buildfiles">
        <pathelement path="../Indus"/>
        <pathelement path="../StaticAnalyses"/>
        <pathelement path="../JavaSlicer"/>
    </path>

    <target name="init">
        <tstamp/>
    </target>

    <target name="dist" depends="init, cleanAll, buildAllCode, buildAllDoc">
		<anttask target="package"/>
	</target>
	
	<target name="package">
        <mkdir dir="${dist.dir}"/>
        <delete>
            <fileset dir="${dist.dir}" includes="*"/>
        </delete>
        <copy todir="${dist.ug.dir}" flatten="true">
            <fileset dir="..">
                <include name="*/docs/ug/build/*.pdf"/>
            </fileset>
        </copy>
        <zip destfile="${docs.zip.filename}">
            <zipfileset dir="../Indus/docs/javadocs/" prefix="Indus/Indus/docs/javadocs"/>
            <zipfileset dir="../StaticAnalyses/docs/javadocs/" prefix="Indus/StaticAnalyses/docs/javadocs"/>
            <zipfileset dir="../JavaSlicer/docs/javadocs/" prefix="Indus/JavaSlicer/docs/javadocs"/>
            <zipfileset dir="${dist.ug.dir}" prefix="Indus/ug"/>
        </zip>
        <delete dir="${dist.ug.dir}"/>

        <copy todir="${dist.dir}" flatten="true">
            <fileset dir="..">
                <include name="*/*.jar"/>
                <exclude name="*/*src*.jar"/>
            </fileset>
        </copy>

        <move todir="${dist.dir}">
            <fileset dir="${dist.dir}">
                <include name="*.jar"/>
            </fileset>
            <mapper type="glob" from="*.jar" to="*-${DSTAMP}.jar"/>
        </move>

        <zip destfile="${examples.src.zip.filename}">
            <fileset dir="..">
                <include name="*/src-xml/**/*CLI.java"/>
            </fileset>
        </zip>
    </target>

    <target name="cleanAll" depends="init">
        <subant target="clean">
            <buildpath refid="subprojects.buildfiles"/>
        </subant>
    </target>

    <target name="buildAllCode" depends="init">
        <subant target="build">
            <buildpath refid="subprojects.buildfiles"/>
        </subant>
        <subant target="jar">
            <buildpath refid="subprojects.buildfiles"/>
        </subant>
    </target>

    <target name="buildAllDoc" depends="init">
        <subant target="docs">
            <buildpath refid="subprojects.buildfiles"/>
        </subant>
    </target>

</project>
